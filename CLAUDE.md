# CLAUDE.md (Aegis v14) — Token-Lean

> 목적: Claude Code가 **v14 설계 단계**에서 일관되게 문서를 작성/유지하도록 강제한다.  
> 우선순위: **이 파일 > docs/ 설계 문서 > 코드(구현 단계에서만)**

---

## 0) 현재 모드: DESIGN (설계)
- 지금은 **설계 단계**다. 기본 출력은 **문서/아키텍처/인터페이스**다.
- 구현(코드)은 `PHASE=IMPLEMENT`로 명시되기 전까지 금지.
- 코드 요청이 오면: **(1) 설계 문서 수정안 → (2) 작업 리스트 → (3) 구현 단계 전환 조건** 순서로 응답.

---

## 1) 절대 규칙 (Non-negotiable)
1. **한국어로 응답** (코드/커밋 메시지 제외)
2. **문서 우선**: 문서 없이 구현 금지
3. **SSOT 준수**: 책임은 정해진 문서/모듈 위치에만 둔다(중복 금지)
4. **모듈 독립성**: 모듈은 인터페이스로만 연결(순환 참조 금지)
5. **새 문서 생성 시 `docs/_index.md` 등록**
6. **shadcn/ui 사용 전 설치 확인**(설치 없이 import 금지)
7. **모호한 설계 금지**: “처리한다/동기화한다” 같은 표현은 금지, 구체적 입력/출력/실패 처리까지 명시

---

## 2) SSOT 위치 규칙
- 시스템 아키텍처: `docs/architecture/`
- 모듈 설계: `docs/modules/`
- DB 스키마/ERD: `docs/database/`
- API 계약: `docs/api/`
- UI 설계: `docs/ui/`
- 금지: 설계 문서를 루트/`backend/`/`frontend/`에 생성

---

## 3) 작업 완료 기준 (DoD)
작업은 아래 3개가 모두 충족되어야 “완료”:
1. **SSOT**: 변경이 올바른 책임 경계 안에 있음(순환 참조 없음)
2. **Docs Sync**: 관련 문서가 갱신됨(필요 시 `_index.md` 포함)
3. **Git**: 논리 단위로 커밋(설계 단계는 `docs(scope): ...`)

---

## 4) shadcn/ui (CRITICAL)
- 컴포넌트 사용 전: `frontend/components/ui/`에 존재 여부 확인
- 없으면 먼저 설치:
  - `npx shadcn@latest add <component>`
- 설치 없이 아래 패턴 금지:
  - `import { X } from "@/components/ui/x"`

---

## 5) 프로젝트 구조(설계 단계 기준)
v14/
docs/
_index.md
architecture/
modules/
database/
api/
ui/
backend/ (구현 단계에서 생성)
frontend/ (구현 단계에서 생성)

yaml
코드 복사

---

## 6) 설계 작업 순서 (강제)
1. 아키텍처: 개요/데이터 흐름/레이어 책임
2. 모듈: 책임/인터페이스/의존성 방향
3. DB: ERD/스키마/인덱스/마이그레이션
4. API: 엔드포인트/스키마/에러코드/인증
5. UI: 페이지/컴포넌트/상태관리/연동

---

## 7) 템플릿(본 파일에 장문 포함 금지)
- 장문 템플릿은 `docs/templates/`로 분리한다.
  - 예: `docs/templates/module.md`, `db-schema.md`, `api.md`
- 이 파일에는 “필수 섹션 목록”만 유지:

### 모듈 설계 필수 섹션
- 개요(책임/위치/의존성)
- 외부 인터페이스(제공)
- 내부 의존(요구)
- 데이터 모델(입력/출력)
- 처리 흐름(단계화)
- 에러/리트라이/아이템포턴시
- 성능/보안/테스트

### DB 설계 필수 섹션
- ERD
- 테이블(목적/컬럼/제약/인덱스)
- 마이그레이션 순서

### API 설계 필수 섹션
- 목적/권한
- Request(파라미터/바디)
- Response(성공/에러)
- 에러 코드 표준
- 구현 위치(핸들러/서비스/리포)

---

## 8) 금지 패턴(요약)
- 문서 없이 코드 작성
- 동일 내용을 여러 문서에 중복 기재(SSOT 위반)
- 순환 참조(모듈 A↔B)
- “껍데기 구현”/항상 default 반환/중요 기능 TODO로 미루기(특히 안전장치)
- 모호한 요구/모호한 결과(입력·출력·실패 처리가 없는 설계)

---

## 9) 커밋 규칙(설계 단계)
- 기본: `docs(scope): 변경 요약`
  - 예: `docs(architecture): data-flow 초안`
  - 예: `docs(modules): exit-engine 인터페이스 추가`

---

## 10) 참고(로컬)
- v10: `/Users/wonny/Dev/aegis/v10/CLAUDE.md`
- v13: `/Users/wonny/Dev/aegis/v13/CLAUDE.md`

---

## 11) 유지보수 규칙(토큰 절약)
- 이 파일은 **1~2페이지 분량 유지**(반복/장문 예시 금지)
- 자세한 예시/케이스 스터디/워크플로우는 `docs/playbooks/` 또는 `docs/templates/`로 이동
- 새 규칙을 추가할 때는 “한 줄 규칙 + 금지/허용 예시 1개”까지만